---
layout: post
title: 软件无线电安全研究工具
category: 信息安全
tags: SDR，GNU Radio
description: 节选于书籍《无线电安全攻防大揭秘》
---
>节选于书籍《无线电安全攻防大揭秘》

## 1 软件无线电技术
软件无线电技术，即Software Define Radio(SDR)，有时也成为Software Radio。
如图所示是典型的软件无线电处理流程图。为了理解无线电的软件模块，受限需要理解与其关联的硬件。在图中的接受路径上，能够看到有天线、RF前端、ADC和代码。ADC是一个连接连续的“Analog”自然世界和离散的“Digital”世界的桥梁。

　　　　　　　　　　　  ![2016-12-30-1](/public/img/2016-12-30-1.png)

ADC有两个主要特性：采样率和动态范围。采样率是ADC测量模拟信号的速度；动态范围是ADC区最小信号值和最大信号值的精读，这决定了ADC数字信号输出的比特数（位数）。例如，8位的AD转换器最多能代表256个信号层次，而16位的转换器能够代表65536个层次的信号。总的来说，ADC的物理特性和价格决定了采样率和动态范围。

1927年，出生于瑞典的物理和电子学家Harry Nyquist提出了如果想使AD转换没有混叠现象发生，那么采样率至少是目标型号带宽的2倍。这就是著名的奈奎斯特定律。

假设我们要处理一低通信号，信号带宽是0~fmax，按照奈奎斯特理论，采样率必须至少是2*fmax。如果ADC的采样率是20MHz，但是我们想收听92.1MHz的FM电台，该怎么办呢？答案是使用RF前端，接收机的RF前端能够把它接收到的高频信号下变频到一个低频段信号后输出。例如，如果能让RF前端吧90~100MHz频段内的信号下变频到0~10MHz低频段范围内，那么20MHz的ADC就能够排上用场了。

在大多数情况下，我们把RF前端当做一个信号控制的黑盒子，负责处理输入信号的中心频率，使信号在高频和低频之间转换。举一个具体的例子，一个调制解调器的调制模块能够把50~800MHz之间的6MHz带宽的信号下变频到一个中心频率是0Hz的信号输出。这个输出的中心频率通常称作中频（IF）。中频为0的接收机称为零中频接收机。随着射频芯片和ADC芯片越来越强大，零中频接收机也变得越来越常见。

其实，如果ADC的采样率相对于射频信号的频率差别不是很大的话，RF前端也能够被去掉。有一个GNU Radio用户已经成功地使用一个100英尺（1一英尺等于12英寸，和0.305米）的天线直接连接到20MHz采样率的ADC上收听到了AM（300KHz~3MHz）和短波（3~30MHz）广播。

上面图中的最后一个模块“Your Code Here!”，就是软件代码所在的部分。在广义的软件无线电概念中，软件代码值各种“可编程”的代码，不仅是运行在CPU上的代码，也包括DSP和FPGA上平台上的代码。但在本书中，主要指运心在CPU上的代码。因为CPU是最广泛使用的编程平台，运行在CPU上的软件无线电代码最方便移植。

### 1.1 SDR的强大能力
在互联网行业有句话：“Software is eating the world”。

这是网景公司的创始人马克·安德森（Marc Andreessen）说的。我想这句话不仅针对互联网公司，对整个工业界都是成立的。无线通信行业，有了SDR的进入，正在发生这快速的变化。

太早之前的故事，这里就不细说了，感兴趣的读者可以读一下维基百科中“Software Defined Radio”这一词条。2000年以后，推动SDR技术的两大功臣，是GNU Radio和USPR这对搭档。

USRP是2004年有Matt Ettus开发的，公司就命名为Ettus Research。在USRP出现之前，SDR都是基于一些价格十几万元人民币的PCI板卡。USRP 一下子把SDR的价格拉低到了几千元人民币。

GNU Radio最早出现在2001年，2004年重写了整个项目，配合USRP，实现了一套完整的软硬件平台。这对搭档从此书写了SDR的新历史，使SDR成为了真正普及的工具。

SDR可以极大的“放大”程序员的能力。

2009年，利用USRP，OpenBTS（http://openbts.org/)这个项目第一次用SDR实现了一真正能用的GSM基站。而且OpenBTShi开源的，使得每一个程序员只要有USRP，就可以搭建一个GSM小基站。后来，使用SDR来实现基站的尝试就一直没有停止过。2012年，著名的法国程序员Fabrice Bellard（http://www.bellard.org/)以一人之力，开发出了基于USRP+CPU结构的完整LTE基站的功能；而在传统的电信设备制造企业中，开发一个基站至少需要多个软硬件团队的相互配合。毫不夸张的说，Fabrice Bellard一个人相当于100个普通程序员的生产力。

### 1.2 SDR用途

由于软件无线电具有能有快速开发、迭代更新的特点，所以他特别适合用在一些定制化的应用中。例如：  

* 学生和研究人员用它来研究无线信号处理算法，研究新的通信协议。因为所有的通信协议，从上至下都是PC上的软件代码。你可以像使用普通代码一样快速自如地修改、编译和运行，可以灵活的在多个协议层之间相互操作。当你撰写学术论文时，这些真实的实验结果常常能够作为理论分析的强有力支撑。  
* 创业型小公司或者学校里做产品开发类项目的人员，通常用它来开发原型设备POC（Prototype of Concept）。比如做一个支持多种制式的家庭网关，因为所有的东西都是“软”的，所以开发起来非常快，出现问题也容易修改。  
* 用来高校里的教学用实验平台。比如做通信原理实验，现在大部分实验都是用MATLAB仿真来做的，当有了
GNU Radio后，你就可以看到真正的信号星座图、频率漂移现象。而且它可以是一个远程的平台，共很多学生同时使用。  
* 业余无线电爱好者，他们用GNU Radio来搭建自己的电台。还有些射电天文学的爱好者，利用SDR来搭建自己的射电天文台。2014年，有一个民间项目ISEE3 Reboot Project，利用USRP和GNU Radio，与一个已经发射到太空60年之久的ISEE3卫星通信，试图重启它的动力系统（http://spacecollege.org/isee3/）。  
* 黑客！这是SDR用户中很大的一个群体。安全公司以及政府的无线电监控部门、军方的实验室对此很有兴趣。目前SDR技术已经广泛地使用在各个频段，用于无线电信号监听、逆向分析、欺骗攻击、监控防御等。这也是本书的主题。

## 2 GNU Radio简介

上一节介绍了SDR。SDR的应用可以有很多种实现方式，GNU Radio是其中的一种。

GNU Radio是一套自由开源软件工具，它提供了各种信号的处理模块，可用于实现软件无线电系统。它可以外接一些低成本的射频硬件，从而真正的实现有线信号发射接收的完整系统；也可以在没有射频硬件的情况下，运行一些仿真程序。GNU Radio已经被广泛用于科研、商业应用和业余爱好者的活动中。

用手机操作系统来类比，手机可以有很多种操作系统，如ios、安卓、windows、linux；GNU Radio有点像安卓系统，提供了一套运行和开发的平台，屏蔽了底层硬件的细节，可以支持多种射频硬件，而且是完全开源的。

* 使用GNU Radio能做什么？

GNU Radio几乎能完成所有的 __无线处理功能__。你可以写一个程序，从接收到的数字信号中读取数据；也可以把数据推送给发射信号流，然后从射频硬件发射出去。GNU Radio有滤波器、信道编码、同步模块、均衡器、信道解码，还有许多其他的模块。在GNU Radio的术语中，称之为“block”，在这里译为“模块”吧。更重要的是，GNU Radio提供了一种方法，把这些模块连接在一起，而且能够自动地管理信号从一个模块流动到另一模块。扩展GNU Radio也非常容易，如果发现缺少某种模块，则可以自己编写一个新模块，把他添加进去。

既然GNU Radio是软件，那么他只能处理数字信号。一般来说，接受信号和发射信号，都用 __复数基带信号__这种数据类型来表示。外部的射频硬件完成数字信号与模拟信号之间的转换，还负责完成信号在基频和射频之间的搬移。在GNU Radio内部的模块之间，数据可以以各种格式流动，比如比特、字节、向量、数据包（burst），或者更复杂的一些数据格式。

GNU Radio使用Python语言写的，其中对计算性能要求很高的模块，使用C++语言写的。因此，GNU Radio既满足了易用性，又满足了无线系统对实时性和高信号吞吐量的要求。

* 必须懂得编程才能使用GNU Radio吗？

当然最好是懂得编程。然而，GNU Radio也提供了其他的方法，方便不懂的编程的人使用。首先，GNU Radio有一个叫GNU Radio Companion（GRC）的工具，具有完全图形化的界面，类似于Simulink，只需要拖动模块，就可以搭建一个无线系统；其次，GNU Radio还提供了一些现成的应用程序，这些程序可以实现一些基本的操作，例如录制一段射频信号、做频谱分析等。

如果你想扩展GNU Radio的功能（例如增加新的功能模块），那么就必须懂得编写代码。这笔使用GRC难多了，简单点的模块使用Python编程就足够了；对计算性能要求高的模块，就得使用C++编程。

* GNU Radio使用哪种开源许可？

GNU Radio采用了GPL 3.0（General Public License version 3.0），软件的版权属于自由软件基金会。

关于几种开元软件许可的差别，在此引用阮一峰博文中的一张图，能够简明、清晰地说明GPL许可的特点。

　　　　　　　　　　　  ![2016-12-30-2](/public/img/2016-12-30-2.png)

由此可知，GNU Radio修改源码之后，不能闭源；新增的代码也必须使用同样的GPL许可证。

* 人们使用GNU Radio做了些什么？

如果你安装了GNU Radio，就会看到其中包含了很多的使用范例，比如由发射数字信号的例子，有接受模拟信号波形的例子，还有很多其他的例子。除了GNU Radio自己收录的这些范例程序外，该有CGRAN（http：//www.cgran.org/)网站，收率了大量的GNU Radio项目。另外，http://gnuradio.org/redmine/projects/gnuradio/wiki/ OtherCode也收录了一些项目。

* 数字信号处理、基带、同步等都是什么？

如果你问出这个问题，则说明缺乏无线通信的基础知识，那么对你来说使用GNU Radio就很困难了。因为它毕竟知识一个工具，你必须懂得无限通信和信号处理的原理，才能够用工具搭建一个系统。不过也不必被吓到，着一些相关书籍学习一下，再配合GNU Radio的代码，理论结合实践，相信你一定可以进步神速。

## 3 GNU Radio支持的硬件工具

虽然GNU Radio在没有硬件支持的情况下，也可以做一些仿真，不过那样就太无趣了。所以每一个想玩GNU Radio的小伙伴，至少装备一种硬件吧。这一届我们就简单介绍几种常用的GNU Radio能够支持的硬件工具。

### 3.1 USRP

第一种要介绍的硬件当然是大名鼎鼎的USRP。USRP有Ettus Research（www.ettus.com)公司制造。这个公司是2004年有Matt Ettus从GNU Radio项目中独立出来之后创立的。Matt Ettus he和USRP1如图所示。

USRP是开源的，它的电路原理图、HDL代码和上位机代码都是开源的。于是国内一下子就出现了好几家复制USRP的公司，价格更便宜。2010年，Ettus公司被NI（National Instruments）收购，但仍然保持独立的品牌，并且继续保持开源的风格。USRP现在已经被广泛用在各种与无线通信相关的科研、教学、监控监测、军事和安全方面。

USRP经过了十几年的发展，已经有多个产品系列，根据接口类型的不同，有：

* USRP X 系列——X系列使用10G以太网接口，是USRP中性能最强的系列，可以支持到120MHz射频带宽。
* USRP N 系列——N系列使用1G以太网接口，N系列在X系列出现以前，是非常热门的一款产品，用户量很大。
* USRP B 系列——B 系列使用USB接口，早期是USB2.0接口。第一代USRP产品，叫USRP1，就是使用USB2.0接口的。现在都在使用USB3.0。USB接口的有点是，接口数量多，而且带有USB接口的设备非常多，除了计算机以外，手机、小型嵌入式设备都有USB接口。所以USB接口是一种广泛存在、非常方便的接口。
* USRP E 系列——E系列是独立运行的USRP设备，自带ARM处理器，无须上位机。这个系列特别适合那些需要独立运行的小系统。

今天，USRP正在朝两个方向同时发展，其中一个方向是追求性能，代表就是X系列。  
一个X310的高度是1U，两个X310正好可以塞进一个1U的机架。每个X310可以配上两个射频子板。X310不仅可以支持高射频带宽，而且还带有强大FPGA，可以分担一部分计算任务。

Ettus research公司开发了一种软件工具，叫做RFNoc（RF Network on Chip），类似于GRC那样的图形界面，方便开发FPGA程序。可见，RFNoC代表了USRP正在追求高速、高计算能力这个方向。

另一个方向是“小型化”。Ettus Research在2015年9月发布了一款新的B系列USRP设备，是B200/210迷你版，尺寸如同名片大小，如图：

　　　　　　　　　　　  ![2016-12-30-3](/public/img/2016-12-30-3.png)

B200mini与B200的功能完全相同，他的小身材使其非常便携，也很容易与主机设备集成在一起。GNU Radio正在研发Android版本，B200mini加一部安卓手机，配合GNU Radio安卓版本，就是一个最小的SDR系统。预计黑客们会非常喜欢这个迷你身材的小USRP。

USRP的射频指标与产品型号有关，常用的几款USRP的射频载波都支持及时MHz到几GHz，射频带宽8~120MHz，发射功率10~100dBm，在此就不详细介绍了。

USRP的驱动程序称为UHD（USRP Hardware Driver），它是一套独立的驱动程序，与GNU Radio无关。有很多应用，例如OpenBTS和许多LTE软基站项目，都是直接调用UHD接口的，不依赖于GNU Radio框架。

除了GNU Radio以外，USRP还支持NI自家的LabVIEW，也支持MATLAB。不过因为不是免费开源的，用的人比较少，USRP社区里讨论后两者的人非常少。

### 3.2 RTL-SDR

除了USRP，另一种人气颇高的硬件要数RTL-SDR（http://www.rtl-sdr.com/）了， 如图所示。

　　　　　　　　　　　  ![2016-12-30-4](/public/img/2016-12-30-4.png)

RTL-SDR是一种特别便宜的软件无线电硬件。它原本是一个基于RTL2832U芯片的DVB-TDongle，用来收看电视，俗称“电视棒”。后来发现这种芯片可以直接读取原始的I/Q数据，于是只要安装一个新的驱动程序，电视棒就可以用来作为宽带的软件无线电接收机。

这样一个电视棒价格大约20美元，在淘宝上甚至可以找到30~40元人民币的一个价格。用它配合电脑，就可以实现一个频谱扫描器的功能。过去，这类扫描器需要几百甚至几千美元才能买到。

（1）


| 调谐器               | 频率范围                          |
|--------------------   |---------------------------------  |
| Ebonics E4000         | 52~2200MHz, 1100~1250MHz 空出来  |
| Rafael Micro R820T    | 24~1766MHz                        |
| Rafael Micro R828D    | 24~1766MHz                        |
| Fitipower FC0013      | 22~1100MHz                        |
| Fitipower FC0012      | 22~948.6MHz                       |
| FCI FC2580            | 146~308MHz 和 438~924MHz           |









